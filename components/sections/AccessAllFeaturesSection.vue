<template>
  <section
    class="relative overflow-hidden bg-white w-full sm:min-h-[450px] md:min-h-[560px] lg:min-h-[560px]"
    style="background-color: #f7f7f8; padding: 0"
  >
    <div
      class="absolute hidden bottom-0 left-0 w-full h-auto opacity-30 pointer-events-none md:flex justify-end"
    >
      <svg
        width="562"
        height="257"
        viewBox="0 0 562 257"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M24.0976 458.018C9.44224 347.678 34.2187 238.427 96.4862 187.86C168.973 128.994 292.268 149.657 463.309 340.714C389.806 -374.647 745.514 380.188 659.684 42.3566"
          stroke="#73737F"
          stroke-width="40"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
      </svg>
    </div>

    <div
      class="absolute hidden  inset-0 md:flex justify-center top-0 pointer-events-none overflow-hidden"
    >
      <svg
        width="393"
        height="106"
        viewBox="0 0 393 106"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <g filter="url(#filter0_d_36_5969)">
          <rect
            x="284.5"
            y="32.5"
            width="32"
            height="32"
            rx="8"
            transform="rotate(-180 284.5 32.5)"
            stroke="#E7E7EA"
            shape-rendering="crispEdges"
          />
        </g>
        <g filter="url(#filter1_d_36_5969)">
          <rect
            width="32"
            height="32"
            rx="8"
            transform="matrix(1 -8.74228e-08 -8.74228e-08 -1 108.5 32.5)"
            stroke="#E7E7EA"
            shape-rendering="crispEdges"
          />
        </g>
        <g filter="url(#filter2_d_36_5969)">
          <rect
            x="320.5"
            y="68.5"
            width="32"
            height="32"
            rx="8"
            transform="rotate(-180 320.5 68.5)"
            stroke="#E7E7EA"
            shape-rendering="crispEdges"
          />
        </g>
        <g filter="url(#filter3_d_36_5969)">
          <rect
            width="32"
            height="32"
            rx="8"
            transform="matrix(1 -8.74228e-08 -8.74228e-08 -1 72.5 68.5)"
            stroke="#E7E7EA"
            shape-rendering="crispEdges"
          />
        </g>
        <g filter="url(#filter4_d_36_5969)">
          <rect
            x="392.5"
            y="68.5"
            width="32"
            height="32"
            rx="8"
            transform="rotate(-180 392.5 68.5)"
            stroke="#E7E7EA"
            shape-rendering="crispEdges"
          />
        </g>
        <g filter="url(#filter5_d_36_5969)">
          <rect
            width="32"
            height="32"
            rx="8"
            transform="matrix(1 -8.74228e-08 -8.74228e-08 -1 0.5 68.5)"
            stroke="#E7E7EA"
            shape-rendering="crispEdges"
          />
        </g>
        <g filter="url(#filter6_d_36_5969)">
          <rect
            x="284.5"
            y="104.5"
            width="32"
            height="32"
            rx="8"
            transform="rotate(-180 284.5 104.5)"
            stroke="#E7E7EA"
            shape-rendering="crispEdges"
          />
        </g>
        <g filter="url(#filter7_d_36_5969)">
          <rect
            width="32"
            height="32"
            rx="8"
            transform="matrix(1 -8.74228e-08 -8.74228e-08 -1 108.5 104.5)"
            stroke="#E7E7EA"
            shape-rendering="crispEdges"
          />
        </g>
        <g filter="url(#filter8_d_36_5969)">
          <rect
            x="356.5"
            y="104.5"
            width="32"
            height="32"
            rx="8"
            transform="rotate(-180 356.5 104.5)"
            stroke="#E7E7EA"
            shape-rendering="crispEdges"
          />
        </g>
        <g filter="url(#filter9_d_36_5969)">
          <rect
            width="32"
            height="32"
            rx="8"
            transform="matrix(1 -8.74228e-08 -8.74228e-08 -1 36.5 104.5)"
            stroke="#E7E7EA"
            shape-rendering="crispEdges"
          />
        </g>
        <defs>
          <filter
            id="filter0_d_36_5969"
            x="252"
            y="0"
            width="33"
            height="33.8"
            filterUnits="userSpaceOnUse"
            color-interpolation-filters="sRGB"
          >
            <feFlood flood-opacity="0" result="BackgroundImageFix" />
            <feColorMatrix
              in="SourceAlpha"
              type="matrix"
              values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
              result="hardAlpha"
            />
            <feOffset dy="0.8" />
            <feComposite in2="hardAlpha" operator="out" />
            <feColorMatrix
              type="matrix"
              values="0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 0 0 0 0.56 0"
            />
            <feBlend
              mode="normal"
              in2="BackgroundImageFix"
              result="effect1_dropShadow_36_5969"
            />
            <feBlend
              mode="normal"
              in="SourceGraphic"
              in2="effect1_dropShadow_36_5969"
              result="shape"
            />
          </filter>
          <filter
            id="filter1_d_36_5969"
            x="108"
            y="0"
            width="33"
            height="33.8"
            filterUnits="userSpaceOnUse"
            color-interpolation-filters="sRGB"
          >
            <feFlood flood-opacity="0" result="BackgroundImageFix" />
            <feColorMatrix
              in="SourceAlpha"
              type="matrix"
              values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
              result="hardAlpha"
            />
            <feOffset dy="0.8" />
            <feComposite in2="hardAlpha" operator="out" />
            <feColorMatrix
              type="matrix"
              values="0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 0 0 0 0.56 0"
            />
            <feBlend
              mode="normal"
              in2="BackgroundImageFix"
              result="effect1_dropShadow_36_5969"
            />
            <feBlend
              mode="normal"
              in="SourceGraphic"
              in2="effect1_dropShadow_36_5969"
              result="shape"
            />
          </filter>
          <filter
            id="filter2_d_36_5969"
            x="288"
            y="36"
            width="33"
            height="33.8"
            filterUnits="userSpaceOnUse"
            color-interpolation-filters="sRGB"
          >
            <feFlood flood-opacity="0" result="BackgroundImageFix" />
            <feColorMatrix
              in="SourceAlpha"
              type="matrix"
              values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
              result="hardAlpha"
            />
            <feOffset dy="0.8" />
            <feComposite in2="hardAlpha" operator="out" />
            <feColorMatrix
              type="matrix"
              values="0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 0 0 0 0.56 0"
            />
            <feBlend
              mode="normal"
              in2="BackgroundImageFix"
              result="effect1_dropShadow_36_5969"
            />
            <feBlend
              mode="normal"
              in="SourceGraphic"
              in2="effect1_dropShadow_36_5969"
              result="shape"
            />
          </filter>
          <filter
            id="filter3_d_36_5969"
            x="72"
            y="36"
            width="33"
            height="33.8"
            filterUnits="userSpaceOnUse"
            color-interpolation-filters="sRGB"
          >
            <feFlood flood-opacity="0" result="BackgroundImageFix" />
            <feColorMatrix
              in="SourceAlpha"
              type="matrix"
              values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
              result="hardAlpha"
            />
            <feOffset dy="0.8" />
            <feComposite in2="hardAlpha" operator="out" />
            <feColorMatrix
              type="matrix"
              values="0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 0 0 0 0.56 0"
            />
            <feBlend
              mode="normal"
              in2="BackgroundImageFix"
              result="effect1_dropShadow_36_5969"
            />
            <feBlend
              mode="normal"
              in="SourceGraphic"
              in2="effect1_dropShadow_36_5969"
              result="shape"
            />
          </filter>
          <filter
            id="filter4_d_36_5969"
            x="360"
            y="36"
            width="33"
            height="33.8"
            filterUnits="userSpaceOnUse"
            color-interpolation-filters="sRGB"
          >
            <feFlood flood-opacity="0" result="BackgroundImageFix" />
            <feColorMatrix
              in="SourceAlpha"
              type="matrix"
              values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
              result="hardAlpha"
            />
            <feOffset dy="0.8" />
            <feComposite in2="hardAlpha" operator="out" />
            <feColorMatrix
              type="matrix"
              values="0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 0 0 0 0.56 0"
            />
            <feBlend
              mode="normal"
              in2="BackgroundImageFix"
              result="effect1_dropShadow_36_5969"
            />
            <feBlend
              mode="normal"
              in="SourceGraphic"
              in2="effect1_dropShadow_36_5969"
              result="shape"
            />
          </filter>
          <filter
            id="filter5_d_36_5969"
            x="0"
            y="36"
            width="33"
            height="33.8"
            filterUnits="userSpaceOnUse"
            color-interpolation-filters="sRGB"
          >
            <feFlood flood-opacity="0" result="BackgroundImageFix" />
            <feColorMatrix
              in="SourceAlpha"
              type="matrix"
              values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
              result="hardAlpha"
            />
            <feOffset dy="0.8" />
            <feComposite in2="hardAlpha" operator="out" />
            <feColorMatrix
              type="matrix"
              values="0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 0 0 0 0.56 0"
            />
            <feBlend
              mode="normal"
              in2="BackgroundImageFix"
              result="effect1_dropShadow_36_5969"
            />
            <feBlend
              mode="normal"
              in="SourceGraphic"
              in2="effect1_dropShadow_36_5969"
              result="shape"
            />
          </filter>
          <filter
            id="filter6_d_36_5969"
            x="252"
            y="72"
            width="33"
            height="33.8"
            filterUnits="userSpaceOnUse"
            color-interpolation-filters="sRGB"
          >
            <feFlood flood-opacity="0" result="BackgroundImageFix" />
            <feColorMatrix
              in="SourceAlpha"
              type="matrix"
              values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
              result="hardAlpha"
            />
            <feOffset dy="0.8" />
            <feComposite in2="hardAlpha" operator="out" />
            <feColorMatrix
              type="matrix"
              values="0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 0 0 0 0.56 0"
            />
            <feBlend
              mode="normal"
              in2="BackgroundImageFix"
              result="effect1_dropShadow_36_5969"
            />
            <feBlend
              mode="normal"
              in="SourceGraphic"
              in2="effect1_dropShadow_36_5969"
              result="shape"
            />
          </filter>
          <filter
            id="filter7_d_36_5969"
            x="108"
            y="72"
            width="33"
            height="33.8"
            filterUnits="userSpaceOnUse"
            color-interpolation-filters="sRGB"
          >
            <feFlood flood-opacity="0" result="BackgroundImageFix" />
            <feColorMatrix
              in="SourceAlpha"
              type="matrix"
              values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
              result="hardAlpha"
            />
            <feOffset dy="0.8" />
            <feComposite in2="hardAlpha" operator="out" />
            <feColorMatrix
              type="matrix"
              values="0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 0 0 0 0.56 0"
            />
            <feBlend
              mode="normal"
              in2="BackgroundImageFix"
              result="effect1_dropShadow_36_5969"
            />
            <feBlend
              mode="normal"
              in="SourceGraphic"
              in2="effect1_dropShadow_36_5969"
              result="shape"
            />
          </filter>
          <filter
            id="filter8_d_36_5969"
            x="324"
            y="72"
            width="33"
            height="33.8"
            filterUnits="userSpaceOnUse"
            color-interpolation-filters="sRGB"
          >
            <feFlood flood-opacity="0" result="BackgroundImageFix" />
            <feColorMatrix
              in="SourceAlpha"
              type="matrix"
              values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
              result="hardAlpha"
            />
            <feOffset dy="0.8" />
            <feComposite in2="hardAlpha" operator="out" />
            <feColorMatrix
              type="matrix"
              values="0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 0 0 0 0.56 0"
            />
            <feBlend
              mode="normal"
              in2="BackgroundImageFix"
              result="effect1_dropShadow_36_5969"
            />
            <feBlend
              mode="normal"
              in="SourceGraphic"
              in2="effect1_dropShadow_36_5969"
              result="shape"
            />
          </filter>
          <filter
            id="filter9_d_36_5969"
            x="36"
            y="72"
            width="33"
            height="33.8"
            filterUnits="userSpaceOnUse"
            color-interpolation-filters="sRGB"
          >
            <feFlood flood-opacity="0" result="BackgroundImageFix" />
            <feColorMatrix
              in="SourceAlpha"
              type="matrix"
              values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"
              result="hardAlpha"
            />
            <feOffset dy="0.8" />
            <feComposite in2="hardAlpha" operator="out" />
            <feColorMatrix
              type="matrix"
              values="0 0 0 0 1 0 0 0 0 1 0 0 0 0 1 0 0 0 0.56 0"
            />
            <feBlend
              mode="normal"
              in2="BackgroundImageFix"
              result="effect1_dropShadow_36_5969"
            />
            <feBlend
              mode="normal"
              in="SourceGraphic"
              in2="effect1_dropShadow_36_5969"
              result="shape"
            />
          </filter>
        </defs>
      </svg>
    </div>

    <div
      class="m-auto relative z-10 w-full sm:w-full md:w-[85%] xl:w-[55%] py-10 px-5 sm:py-10 md:py-20"
    >
      <div
        class="bg-[#1A1925] text-center relative rounded-[28px] sm:rounded-[28px] md:rounded-[32px] lg:rounded-[35px] cta-card"
        style="
          display: flex;
          flex-direction: column;
          justify-content: center;
          align-items: center;
          margin: 0 auto;
        "
      >
        <div
          class="absolute -top-[30px] left-1/2 -translate-x-1/2 flex items-center justify-center w-[60px] h-[60px] rounded-[14px] z-20"
        >
          <img src="/favicon.svg" alt="Logo" class="w-20 h-20" />
        </div>
        <h2
          class="relative text-white cta-heading pt-4 sm:pt-0"
          style="
            font-family: 'Funnel Display', sans-serif;
            font-weight: 500;
            letter-spacing: -0.04em;
            text-align: center;
            text-transform: capitalize;
            color: #ffffff;
            font-size: 40px;
          "
        >
          Get Started with Varnish
        </h2>

        <p
          class="relative cta-subtitle"
          style="
            font-family: 'Inter', sans-serif;
            font-weight: 400;
            letter-spacing: -0.011em;
            text-align: center;
            font-size: 16px;
          "
        >
          Get started with a free 14 day trial, no credit card required.
        </p>

       <div class="relative flex flex-col sm:flex-row items-center justify-center gap-2 sm:gap-3 md:gap-4 lg:gap-6 cta-metrics">
  <div
    v-for="(stat, index) in stats"
    :key="index"
    class="flex items-center gap-1"
  >
    <span class="cta-metric-text">
      {{ stat.isMoney ? '$' : '' }}{{ stat.display.value }}{{ stat.isMoney && stat.value % 1 !== 0 ? 'M' : '' }}
    </span>
    <span class="cta-metric-text">{{ stat.label }}</span>
    <span v-if="index < stats.length - 1" class="hidden sm:inline text-gray-600 text-xs sm:text-sm md:text-base">â€¢</span>
  </div>
</div>


        <div class="relative">
          <button
            class="hover:opacity-90 transition-opacity sm:w-[135px] md:w-[145px] lg:w-[153px] sm:h-[32px] md:h-[34px] lg:h-[36px] opacity-100"
            style="
              font-family: 'Inter', sans-serif;
              font-weight: 500;
              font-size: 13px;
              line-height: 20px;
              letter-spacing: -0.006em;
              text-align: center;
              color: #ffffff;
              border-radius: 8px;
              padding-top: 8px;
              padding-right: 2px;
              padding-bottom: 8px;
              padding-left: 2px;
              background: #1f62ff;
              background-image: linear-gradient(
                180deg,
                rgba(236, 236, 236, 0.08) 0%,
                rgba(85, 85, 85, 0.08) 100%
              );
              box-shadow: 0px 0.25px 0.25px 0px rgba(255, 255, 255, 0.12) inset,
                0px 0.75px 0.75px 0px rgba(255, 255, 255, 0.08) inset,
                0px 1px 3px 0px rgba(255, 255, 255, 0.08) inset,
                0px -8px 20px 0px rgba(26, 25, 37, 0.08) inset,
                0px 0.25px 0.25px 0px rgba(26, 25, 37, 0.24),
                0px 0.75px 0.75px 0px rgba(26, 25, 37, 0.12),
                0px 1px 1.5px -0.5px rgba(26, 25, 37, 0.12),
                0px 2px 4px -1px rgba(26, 25, 37, 0.12),
                0px 4px 8px -4px rgba(26, 25, 37, 0.12),
                0px 8px 12px -4px rgba(26, 25, 37, 0.06);
            "
          >
            <span class="leading-tight">Get Started ~ Free</span>
          </button>
        </div>
      </div>
    </div>
  </section>
</template>

<script setup lang="ts">
import { ref, onMounted } from 'vue';

const stats = [
  { label: 'Employees', value: 120, display: ref(0) },
  { label: 'Raised', value: 31.5, isMoney: true, display: ref(0) },
  { label: 'Years old', value: 7, display: ref(0) },
];

const hasAnimated = ref(false);

const DESKTOP_WIDTH = 1024;

const animateNumber = (stat: any, duration = 2000) => {
  const start = 0;
  const end = stat.value;
  const startTime = performance.now();

  const step = (currentTime: number) => {
    const progress = Math.min((currentTime - startTime) / duration, 1);
    stat.display.value = stat.isMoney
      ? parseFloat((end * progress).toFixed(1))
      : Math.floor(end * progress);

    if (progress < 1) {
      requestAnimationFrame(step);
    }
  };

  requestAnimationFrame(step);
};

onMounted(() => {
  if (window.innerWidth < DESKTOP_WIDTH) {
    stats.forEach(stat => {
      stat.display.value = stat.value;
    });
    return;
  }

  const section = document.querySelector('.cta-card');
  if (!section) return;

  const observer = new IntersectionObserver(
    (entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting && !hasAnimated.value) {
          stats.forEach(stat => animateNumber(stat));
          hasAnimated.value = true;
          observer.disconnect();
        }
      });
    },
    { threshold: 0.5 }
  );

  observer.observe(section);
});
</script>


<style scoped>
/* Keeping your existing styles exactly as they were */
.cta-card {
  height: 478px;
  gap: 30px;
}

@media (min-width: 640px) {
  .cta-card {
    width: auto;
    height: auto;
    padding: 5%;
    gap: 20px;
    min-height: 280px;
  }
}

@media (min-width: 768px) {
  .cta-card {
    min-height: 320px;
  }
}

@media (min-width: 1024px) {
  .cta-card {
    min-height: 356px;
  }
}

/* Mobile First Styles */
.cta-heading {
  font-family: "Bricolage Grotesque", sans-serif;
  font-weight: 600;
  font-size: 36px;
  line-height: 43px;
  letter-spacing: -0.04em;
  text-align: center;
  text-transform: capitalize;
  color: #ffffff;
}

@media (min-width: 640px) {
  .cta-heading {
    font-size: 24px;
    line-height: 30px;
  }
}

@media (min-width: 768px) {
  .cta-heading {
    font-size: 32px;
    line-height: 40px;
  }
}

@media (min-width: 1024px) {
  .cta-heading {
    font-size: 40px;
    line-height: 48px;
  }
}

@media (min-width: 1280px) {
  .cta-heading {
    font-size: 48px;
    line-height: 56px;
  }
}

.cta-subtitle {
  font-family: "Inter", sans-serif;
  font-weight: 400;
  font-size: 14px;
  line-height: 20px;
  letter-spacing: -0.011em;
  text-align: center;
  color: #d4d4d4;
  padding-left: 40px;
  padding-right: 40px;
}

@media (min-width: 640px) {
  .cta-subtitle {
    font-size: 11px;
    line-height: 16px;
    padding-left: 0;
    padding-right: 0;
  }
}

@media (min-width: 768px) {
  .cta-subtitle {
    font-size: 13px;
    line-height: 20px;
  }
}

@media (min-width: 1024px) {
  .cta-subtitle {
    font-size: 14px;
    line-height: 22px;
  }
}

@media (min-width: 1280px) {
  .cta-subtitle {
    font-size: 16px;
    line-height: 24px;
  }
}

.cta-metric-text {
  font-family: "Funnel Display", sans-serif;
  font-weight: 500;
  font-size: 20px;
  line-height: 28px;
  letter-spacing: -0.02em;
  text-align: center;
  color: #ffffff;
}

@media (min-width: 640px) {
  .cta-metric-text {
    font-size: 12px;
    line-height: 18px;
  }
}

@media (min-width: 768px) {
  .cta-metric-text {
    font-size: 16px;
    line-height: 22px;
  }
}

@media (min-width: 1024px) {
  .cta-metric-text {
    font-size: 18px;
    line-height: 24px;
  }
}

@media (min-width: 1280px) {
  .cta-metric-text {
    font-size: 20px;
    line-height: 28px;
  }
}
</style>
